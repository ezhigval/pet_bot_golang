# Техническое задание (Technical Specification) — ЗЕЛЕНИАЛ

Цель: предоставить полное описание всех микросервисов, API, баз данных и интеграций для разработки MVP и последующего расширения проекта.

---

## 1. Общие принципы

1. Архитектура: микросервисная, все сервисы независимы, общение через Kafka.
2. Языки: Backend — Go, Frontend Web — React+Vite, Mobile — Kotlin и Swift.
3. Базы данных: PostgreSQL для хранения бизнес-данных, отдельная зашифрованная БД для персональных данных.
4. Логирование: Zerolog.
5. Аутентификация: JWT + 2FA.
6. Документация API: Swagger/OpenAPI (будет генерироваться для каждого сервиса).

---

## 2. User Service

**Цель:** регистрация, авторизация, управление профилем, контроль устройств, защита от пиратства.

### Функции:
- Регистрация с email, телефоном и устройствами.
- Авторизация и JWT.
- 2FA через email или SMS.
- Проверка уникальности устройства при регистрации.
- Контроль бесплатного периода и ограничение повторных регистраций.
- Уведомления об подозрительных регистрациях администраторам.

### База данных:
- Таблица `users`: id, email, phone, hashed_password, created_at, updated_at.
- Таблица `devices`: id, user_id, device_id, ip_address, created_at.
- Таблица `registrations`: user_id, device_id, registration_attempt, status, created_at.

### API:
| Метод | Путь             | Описание |
|-------|-----------------|----------|
| POST  | /register       | Регистрация нового пользователя |
| POST  | /login          | Авторизация |
| POST  | /2fa/verify     | Подтверждение двухфакторной аутентификации |
| GET   | /profile        | Получение информации профиля |
| PUT   | /profile        | Редактирование профиля |
| GET   | /health         | Проверка работы сервиса |

---

## 3. Finance Service

**Цель:** управление подписками, платежами, прогноз бюджета.

### Функции:
- Подключение и проверка подписок.
- Учёт расходов и доходов.
- Интеграция с календарём и транспортными расходами.
- Генерация отчётов и аналитики.

### База данных:
- Таблица `subscriptions`: id, user_id, plan, start_date, end_date, status.
- Таблица `transactions`: id, user_id, type, amount, date, category.

### API:
| Метод | Путь          | Описание |
|-------|---------------|----------|
| GET   | /balance      | Получить баланс пользователя |
| POST  | /transaction  | Создать транзакцию |
| GET   | /transactions | Список транзакций |
| POST  | /subscribe    | Подключение подписки |
| GET   | /subscriptions | Список подписок пользователя |

---

## 4. Planning Service

**Цель:** календарь, задачи, напоминания, трекеры привычек.

### Функции:
- Создание и редактирование событий.
- Привязка событий к привычкам и целям.
- Напоминания и push-уведомления.
- Синхронизация с Health и Learning.

### База данных:
- Таблица `events`: id, user_id, title, description, start_time, end_time, category, status.
- Таблица `habits`: id, user_id, habit_name, frequency, progress.

### API:
| Метод | Путь      | Описание |
|-------|-----------|----------|
| GET   | /events   | Список событий |
| POST  | /events   | Создать событие |
| PUT   | /events/{id} | Обновить событие |
| DELETE | /events/{id} | Удалить событие |
| GET   | /habits   | Список привычек |
| POST  | /habits   | Добавить привычку |

---

## 5. Health Service

**Цель:** трекер здоровья, стресс, привычки, эмоциональный интеллект.

### Функции:
- Отслеживание физических параметров (шаги, сон, пульс).
- Трекинг стресса.
- Подключение медитаций и практик.
- Генерация рекомендаций на основе данных.

### База данных:
- Таблица `health_data`: id, user_id, type, value, date.
- Таблица `meditation_sessions`: id, user_id, session_type, duration, date.

---

## 6. Learning Service

**Цель:** рекомендации по развитию навыков и обучению.

### Функции:
- Подбор курсов, событий и книг.
- Персональные советы по развитию.
- Интеграция с календарём.

### База данных:
- Таблица `recommendations`: id, user_id, type, content, date_generated.

---

## 7. Reflection Service

**Цель:** журнал рефлексий, анализ продуктивности.

### Функции:
- Ведение дневника.
- AI-анализ продуктивности.
- Персонализированные рекомендации.

### База данных:
- Таблица `reflections`: id, user_id, content, mood, date.

---

## 8. Интеграция и сообщения

- Все сервисы общаются через Kafka topics.
- Пользовательские запросы проходят через API Gateway.
- События (registration, login, subscription_change) транслируются по Kafka для других сервисов.

---

## 9. Безопасность

- TLS/HTTPS.
- Шифрование данных (AES-256) и паролей (bcrypt).
- 2FA.
- Ограничение бесплатных периодов и контроль устройств.
- Rate-limiting и защита от DDoS.
- Анонимизация данных при работе AI.

---

## 10. CI/CD и тестирование

- GitHub Actions для сборки, тестов и деплоя.
- Контейнеризация через Docker.
- Линтеры, тесты unit/integration для каждого микросервиса.
- Swagger/OpenAPI для генерации документации API.

